<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ModernShop - ช้อปปิ้งออนไลน์</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Kanit -->
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600&display=swap" rel="stylesheet">
    
    <!-- Icons (Lucide) -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        body {
            font-family: 'Kanit', sans-serif;
            background-color: #f8fafc;
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }

        .slide-in-right {
            animation: slideInRight 0.3s ease-out forwards;
        }

        @keyframes slideInRight {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1; 
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8; 
        }

        /* Product Card Hover Effect */
        .product-card {
            transition: all 0.3s ease;
        }
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
        }

        /* Category Button Active State */
        .category-btn.active {
            background-color: #4f46e5;
            color: white;
            border-color: #4f46e5;
        }

        /* Toast Notification */
        #toast-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 9999;
        }
        .toast {
            background: white;
            border-left: 4px solid #4f46e5;
            padding: 16px;
            margin-top: 10px;
            border-radius: 4px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 12px;
            animation: slideInRight 0.3s ease-out;
            min-width: 300px;
        }
    </style>
</head>
<body class="text-slate-800">

    <!-- Navbar -->
    <nav class="sticky top-0 z-40 bg-white/80 backdrop-blur-md border-b border-slate-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <!-- Logo -->
                <div class="flex-shrink-0 flex items-center gap-2 cursor-pointer" onclick="renderHome()">
                    <div class="bg-indigo-600 p-2 rounded-lg text-white">
                        <i data-lucide="shopping-bag" size="24"></i>
                    </div>
                    <span class="font-bold text-xl tracking-tight text-indigo-900">ModernShop</span>
                </div>

                <!-- Desktop Menu -->
                <div class="hidden md:flex space-x-8">
                    <a href="#" class="text-slate-600 hover:text-indigo-600 transition-colors font-medium">หน้าหลัก</a>
                    <a href="#products" class="text-slate-600 hover:text-indigo-600 transition-colors font-medium">สินค้าทั้งหมด</a>
                    <a href="#" class="text-slate-600 hover:text-indigo-600 transition-colors font-medium">โปรโมชั่น</a>
                    <a href="#" class="text-slate-600 hover:text-indigo-600 transition-colors font-medium">ติดต่อเรา</a>
                </div>

                <!-- Right Icons -->
                <div class="flex items-center gap-4">
                    <!-- Search (Hidden on mobile) -->
                    <div class="hidden sm:block relative">
                        <input type="text" placeholder="ค้นหาสินค้า..." class="pl-10 pr-4 py-1.5 bg-slate-100 border-none rounded-full text-sm focus:ring-2 focus:ring-indigo-500 outline-none w-48 transition-all focus:w-64">
                        <i data-lucide="search" class="absolute left-3 top-2 text-slate-400 w-4 h-4"></i>
                    </div>

                    <!-- Cart Button -->
                    <button onclick="toggleCart()" class="relative p-2 text-slate-600 hover:bg-slate-100 rounded-full transition-colors group">
                        <i data-lucide="shopping-cart" class="w-6 h-6 group-hover:text-indigo-600"></i>
                        <span id="cart-count" class="absolute top-0 right-0 bg-red-500 text-white text-xs font-bold rounded-full h-5 w-5 flex items-center justify-center transform scale-0 transition-transform duration-200">0</span>
                    </button>

                    <!-- User Button -->
                    <div id="auth-section">
                        <button onclick="openLoginModal()" class="flex items-center gap-2 bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-1.5 rounded-full transition-colors text-sm font-medium shadow-md shadow-indigo-200">
                            <i data-lucide="log-in" class="w-4 h-4"></i>
                            เข้าสู่ระบบ
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <header class="relative bg-white overflow-hidden">
        <div class="max-w-7xl mx-auto">
            <div class="relative z-10 pb-8 bg-white sm:pb-16 md:pb-20 lg:max-w-2xl lg:w-full lg:pb-28 xl:pb-32 pt-20 px-4 sm:px-6 lg:px-8">
                <main class="mt-10 mx-auto max-w-7xl sm:mt-12 md:mt-16 lg:mt-20 xl:mt-28 fade-in">
                    <div class="sm:text-center lg:text-left">
                        <h1 class="text-4xl tracking-tight font-extrabold text-slate-900 sm:text-5xl md:text-6xl">
                            <span class="block xl:inline">ช้อปสนุก สไตล์ใหม่</span>
                            <span class="block text-indigo-600">ที่ ModernShop</span>
                        </h1>
                        <p class="mt-3 text-base text-slate-500 sm:mt-5 sm:text-lg sm:max-w-xl sm:mx-auto md:mt-5 md:text-xl lg:mx-0">
                            ค้นพบสินค้าคุณภาพเยี่ยมที่เราคัดสรรมาเพื่อคุณโดยเฉพาะ พร้อมโปรโมชั่นสุดพิเศษและบริการจัดส่งที่รวดเร็วทันใจ
                        </p>
                        <div class="mt-5 sm:mt-8 sm:flex sm:justify-center lg:justify-start gap-3">
                            <div class="rounded-md shadow">
                                <a href="#products" class="w-full flex items-center justify-center px-8 py-3 border border-transparent text-base font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 md:py-4 md:text-lg md:px-10 transition-all hover:shadow-lg">
                                    เริ่มช้อปเลย
                                </a>
                            </div>
                            <div class="mt-3 sm:mt-0 sm:ml-3">
                                <a href="#" class="w-full flex items-center justify-center px-8 py-3 border border-transparent text-base font-medium rounded-md text-indigo-700 bg-indigo-100 hover:bg-indigo-200 md:py-4 md:text-lg md:px-10 transition-all">
                                    ดูโปรโมชั่น
                                </a>
                            </div>
                        </div>
                    </div>
                </main>
            </div>
        </div>
        <div class="lg:absolute lg:inset-y-0 lg:right-0 lg:w-1/2 bg-indigo-50">
            <img class="h-56 w-full object-cover sm:h-72 md:h-96 lg:w-full lg:h-full opacity-90" src="https://images.unsplash.com/photo-1483985988355-763728e1935b?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80" alt="Woman shopping online">
        </div>
    </header>

    <!-- Product Section -->
    <section id="products" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16">
        <div class="text-center mb-10 fade-in" style="animation-delay: 0.2s;">
            <h2 class="text-base text-indigo-600 font-semibold tracking-wide uppercase">คอลเลกชันใหม่</h2>
            <p class="mt-2 text-3xl leading-8 font-extrabold tracking-tight text-slate-900 sm:text-4xl">
                สินค้าแนะนำสำหรับคุณ
            </p>
        </div>

        <!-- Category Filter -->
        <div class="flex flex-wrap justify-center gap-2 mb-10 fade-in" style="animation-delay: 0.3s;">
            <button onclick="filterProducts('All')" class="category-btn active px-6 py-2 rounded-full border border-slate-200 text-slate-600 font-medium hover:bg-indigo-50 hover:text-indigo-600 transition-all text-sm sm:text-base">
                ทั้งหมด
            </button>
            <button onclick="filterProducts('Electronics')" class="category-btn px-6 py-2 rounded-full border border-slate-200 text-slate-600 font-medium hover:bg-indigo-50 hover:text-indigo-600 transition-all text-sm sm:text-base">
                อิเล็กทรอนิกส์
            </button>
            <button onclick="filterProducts('Fashion')" class="category-btn px-6 py-2 rounded-full border border-slate-200 text-slate-600 font-medium hover:bg-indigo-50 hover:text-indigo-600 transition-all text-sm sm:text-base">
                แฟชั่น
            </button>
            <button onclick="filterProducts('Home')" class="category-btn px-6 py-2 rounded-full border border-slate-200 text-slate-600 font-medium hover:bg-indigo-50 hover:text-indigo-600 transition-all text-sm sm:text-base">
                ของแต่งบ้าน
            </button>
            <button onclick="filterProducts('Sports')" class="category-btn px-6 py-2 rounded-full border border-slate-200 text-slate-600 font-medium hover:bg-indigo-50 hover:text-indigo-600 transition-all text-sm sm:text-base">
                กีฬา
            </button>
        </div>

        <!-- Product Grid -->
        <div id="product-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8">
            <!-- Products will be injected here by JS -->
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-slate-900 text-white mt-20">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div>
                    <div class="flex items-center gap-2 mb-4">
                        <i data-lucide="shopping-bag" class="text-indigo-400"></i>
                        <span class="font-bold text-xl text-white">ModernShop</span>
                    </div>
                    <p class="text-slate-400 text-sm">
                        แพลตฟอร์มช้อปปิ้งออนไลน์ที่ทันสมัยที่สุด มอบประสบการณ์ที่ดีที่สุดให้กับลูกค้าทุกคน
                    </p>
                </div>
                <div>
                    <h3 class="font-semibold text-lg mb-4 text-indigo-400">ลิงก์ด่วน</h3>
                    <ul class="space-y-2 text-slate-400 text-sm">
                        <li><a href="#" class="hover:text-white transition-colors">เกี่ยวกับเรา</a></li>
                        <li><a href="#" class="hover:text-white transition-colors">นโยบายความเป็นส่วนตัว</a></li>
                        <li><a href="#" class="hover:text-white transition-colors">เงื่อนไขการบริการ</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="font-semibold text-lg mb-4 text-indigo-400">ติดตามเรา</h3>
                    <div class="flex space-x-4">
                        <a href="#" class="text-slate-400 hover:text-white transition-colors"><i data-lucide="facebook"></i></a>
                        <a href="#" class="text-slate-400 hover:text-white transition-colors"><i data-lucide="instagram"></i></a>
                        <a href="#" class="text-slate-400 hover:text-white transition-colors"><i data-lucide="twitter"></i></a>
                    </div>
                </div>
            </div>
            <div class="border-t border-slate-800 mt-8 pt-8 text-center text-slate-500 text-sm">
               
            </div>
        </div>
    </footer>

    <!-- Modals & Overlays -->

    <!-- Cart Sidebar -->
    <div id="cart-sidebar" class="fixed inset-0 z-50 overflow-hidden hidden">
        <div class="absolute inset-0 bg-slate-900/50 backdrop-blur-sm transition-opacity" onclick="toggleCart()"></div>
        <div class="absolute inset-y-0 right-0 max-w-md w-full flex">
            <div class="h-full w-full flex flex-col bg-white shadow-xl slide-in-right">
                <div class="flex-1 py-6 overflow-y-auto px-4 sm:px-6">
                    <div class="flex items-start justify-between">
                        <h2 class="text-lg font-medium text-slate-900">ตะกร้าสินค้า</h2>
                        <button onclick="toggleCart()" class="text-slate-400 hover:text-slate-500">
                            <i data-lucide="x"></i>
                        </button>
                    </div>

                    <div class="mt-8">
                        <div class="flow-root">
                            <ul id="cart-items" role="list" class="-my-6 divide-y divide-slate-200">
                                <!-- Cart items will be injected here -->
                                <li class="py-6 flex flex-col items-center justify-center text-center h-64 text-slate-500 empty-cart-msg">
                                    <i data-lucide="shopping-basket" class="w-16 h-16 mb-4 text-slate-300"></i>
                                    <p>ตะกร้าของคุณยังว่างอยู่</p>
                                    <button onclick="toggleCart()" class="mt-4 text-indigo-600 font-medium hover:text-indigo-500">เลือกซื้อสินค้า</button>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="border-t border-slate-200 py-6 px-4 sm:px-6 bg-slate-50">
                    <div class="flex justify-between text-base font-medium text-slate-900 mb-4">
                        <p>ราคารวม</p>
                        <p id="cart-total">฿0</p>
                    </div>
                    <div class="mt-6">
                        <button onclick="openCheckout()" class="w-full flex justify-center items-center px-6 py-3 border border-transparent rounded-md shadow-sm text-base font-medium text-white bg-indigo-600 hover:bg-indigo-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed" id="checkout-btn" disabled>
                            ชำระเงิน
                        </button>
                    </div>
                    <div class="mt-6 flex justify-center text-sm text-center text-slate-500">
                        <p>
                            หรือ <button type="button" class="text-indigo-600 font-medium hover:text-indigo-500" onclick="toggleCart()">เลือกซื้อสินค้าต่อ<span aria-hidden="true"> &rarr;</span></button>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Login Modal -->
    <div id="login-modal" class="fixed inset-0 z-50 flex items-center justify-center hidden">
        <div class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm" onclick="closeLoginModal()"></div>
        <div class="bg-white rounded-2xl shadow-2xl z-10 w-full max-w-md p-8 transform transition-all scale-100 fade-in">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-slate-900">ยินดีต้อนรับกลับมา</h2>
                <button onclick="closeLoginModal()" class="text-slate-400 hover:text-slate-600"><i data-lucide="x"></i></button>
            </div>
            
            <form id="login-form" onsubmit="handleLogin(event)" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-1">อีเมล</label>
                    <input type="email" required class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-all" placeholder="user@example.com">
                </div>
                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-1">รหัสผ่าน</label>
                    <input type="password" required class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-all" placeholder="••••••••">
                </div>
                <div class="flex justify-between items-center text-sm">
                    <label class="flex items-center text-slate-600">
                        <input type="checkbox" class="mr-2 rounded text-indigo-600 focus:ring-indigo-500"> จำฉันไว้
                    </label>
                    <a href="#" class="text-indigo-600 hover:underline">ลืมรหัสผ่าน?</a>
                </div>
                <button type="submit" class="w-full bg-indigo-600 text-white py-2.5 rounded-lg font-medium hover:bg-indigo-700 transition-colors shadow-lg shadow-indigo-200">เข้าสู่ระบบ</button>
            </form>
            
            <div class="mt-6 text-center text-sm text-slate-600">
                ยังไม่มีบัญชี? <a href="#" class="text-indigo-600 font-medium hover:underline">สมัครสมาชิก</a>
            </div>
        </div>
    </div>

    <!-- Checkout Modal -->
    <div id="checkout-modal" class="fixed inset-0 z-50 flex items-center justify-center hidden">
        <div class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm" onclick="closeCheckout()"></div>
        <div class="bg-white rounded-xl shadow-2xl z-10 w-full max-w-2xl max-h-[90vh] overflow-y-auto p-0 fade-in">
            <div class="p-6 border-b border-slate-100 flex justify-between items-center bg-slate-50 rounded-t-xl">
                <h2 class="text-xl font-bold text-slate-900 flex items-center gap-2">
                    <i data-lucide="credit-card" class="text-indigo-600"></i> ชำระเงิน
                </h2>
                <button onclick="closeCheckout()" class="text-slate-400 hover:text-slate-600"><i data-lucide="x"></i></button>
            </div>
            
            <div class="p-6 grid grid-cols-1 md:grid-cols-2 gap-8">
                <!-- Order Summary -->
                <div class="space-y-4">
                    <h3 class="font-semibold text-slate-900">สรุปคำสั่งซื้อ</h3>
                    <div id="checkout-items" class="space-y-3 max-h-48 overflow-y-auto pr-2 custom-scrollbar">
                        <!-- Items rendered here -->
                    </div>
                    <div class="border-t border-slate-200 pt-4 flex justify-between font-bold text-lg text-indigo-700">
                        <span>ยอดรวมทั้งสิ้น</span>
                        <span id="checkout-total">฿0</span>
                    </div>
                </div>

                <!-- Payment Form -->
                <form id="payment-form" onsubmit="handlePayment(event)" class="space-y-4">
                    <h3 class="font-semibold text-slate-900">ข้อมูลจัดส่ง & ชำระเงิน</h3>
                    <div class="grid grid-cols-2 gap-4">
                        <input type="text" placeholder="ชื่อ" required class="w-full px-3 py-2 border rounded-md text-sm focus:ring-2 focus:ring-indigo-500 outline-none">
                        <input type="text" placeholder="นามสกุล" required class="w-full px-3 py-2 border rounded-md text-sm focus:ring-2 focus:ring-indigo-500 outline-none">
                    </div>
                    <textarea placeholder="ที่อยู่จัดส่ง" required class="w-full px-3 py-2 border rounded-md text-sm focus:ring-2 focus:ring-indigo-500 outline-none h-20 resize-none"></textarea>
                    
                    <div class="relative">
                        <input type="text" placeholder="หมายเลขบัตรเครดิต" required class="w-full px-3 py-2 border rounded-md text-sm focus:ring-2 focus:ring-indigo-500 outline-none pl-10">
                        <i data-lucide="credit-card" class="absolute left-3 top-2.5 w-4 h-4 text-slate-400"></i>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <input type="text" placeholder="MM/YY" required class="w-full px-3 py-2 border rounded-md text-sm focus:ring-2 focus:ring-indigo-500 outline-none">
                        <input type="text" placeholder="CVC" required class="w-full px-3 py-2 border rounded-md text-sm focus:ring-2 focus:ring-indigo-500 outline-none">
                    </div>

                    <button type="submit" class="w-full bg-indigo-600 text-white py-3 rounded-lg font-bold hover:bg-indigo-700 transition-colors shadow-md mt-4 flex justify-center items-center gap-2 group">
                        <span>ยืนยันการชำระเงิน</span>
                        <i data-lucide="arrow-right" class="w-4 h-4 group-hover:translate-x-1 transition-transform"></i>
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Success Animation Overlay -->
    <div id="success-overlay" class="fixed inset-0 z-[60] flex flex-col items-center justify-center bg-white hidden">
        <div class="text-center p-8">
            <div class="w-24 h-24 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6">
                <i data-lucide="check" class="w-12 h-12 text-green-600"></i>
            </div>
            <h2 class="text-3xl font-bold text-slate-900 mb-2">ชำระเงินสำเร็จ!</h2>
            <p class="text-slate-500 mb-8">ขอบคุณที่ช้อปกับ ModernShop <br>เราจะจัดส่งสินค้าให้คุณโดยเร็วที่สุด</p>
            <button onclick="window.location.reload()" class="bg-indigo-600 text-white px-8 py-3 rounded-full font-medium hover:bg-indigo-700 transition-colors">
                กลับสู่หน้าหลัก
            </button>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toast-container"></div>

    <script>
        // --- Data (Expanded & Categorized) ---
        const products = [
            // Electronics
            { id: 1, name: 'หูฟังไร้สาย Pro X', category: 'Electronics', price: 2590, image: 'Prox.jpg', categoryLabel: 'อิเล็กทรอนิกส์' },
            { id: 2, name: 'ลำโพง Bluetooth Mini', category: 'Electronics', price: 1590, image: 'https://placehold.co/400x400/pink/white?text=Speaker', categoryLabel: 'อิเล็กทรอนิกส์' },
            { id: 3, name: 'กล้อง Action Cam 4K', category: 'Electronics', price: 5900, image: 'https://placehold.co/400x400/333333/white?text=Camera', categoryLabel: 'อิเล็กทรอนิกส์' },
            { id: 4, name: 'พาวเวอร์แบงค์ 20000mAh', category: 'Electronics', price: 990, image: 'https://placehold.co/400x400/4f46e5/white?text=PowerBank', categoryLabel: 'อิเล็กทรอนิกส์' },
            
            // Fashion
            { id: 5, name: 'รองเท้าวิ่ง Zoom Air', category: 'Fashion', price: 3200, image: 'https://placehold.co/400x400/orange/white?text=Sneakers', categoryLabel: 'แฟชั่น' },
            { id: 6, name: 'กระเป๋าเป้ Classic', category: 'Fashion', price: 1290, image: 'https://placehold.co/400x400/blue/white?text=Backpack', categoryLabel: 'แฟชั่น' },
            { id: 7, name: 'แว่นตากันแดด Retro', category: 'Fashion', price: 990, image: 'https://placehold.co/400x400/gray/white?text=Sunglasses', categoryLabel: 'แฟชั่น' },
            { id: 8, name: 'นาฬิกาข้อมือ Minimal', category: 'Fashion', price: 4500, image: 'https://placehold.co/400x400/purple/white?text=Watch', categoryLabel: 'แฟชั่น' },

            // Home & Living
            { id: 9, name: 'โต๊ะทำงาน Minimal', category: 'Home', price: 5500, image: 'https://placehold.co/400x400/brown/white?text=Table', categoryLabel: 'ของแต่งบ้าน' },
            { id: 10, name: 'โคมไฟตั้งโต๊ะ LED', category: 'Home', price: 890, image: 'https://placehold.co/400x400/yellow/black?text=Lamp', categoryLabel: 'ของแต่งบ้าน' },
            { id: 11, name: 'แจกันเซรามิก', category: 'Home', price: 450, image: 'https://placehold.co/400x400/teal/white?text=Vase', categoryLabel: 'ของแต่งบ้าน' },

            // Sports
            { id: 12, name: 'เสื่อโยคะ Premium', category: 'Sports', price: 790, image: 'https://placehold.co/400x400/green/white?text=YogaMat', categoryLabel: 'กีฬา' },
            { id: 13, name: 'ดัมเบลปรับน้ำหนัก', category: 'Sports', price: 1500, image: 'https://placehold.co/400x400/black/white?text=Dumbbell', categoryLabel: 'กีฬา' }
        ];

        let cart = [];
        let isLoggedIn = false;
        let user = null;
        let currentCategory = 'All';

        // --- Init ---
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();
            renderProducts();
        });

        // --- Render Functions ---
        function renderProducts(category = 'All') {
            const grid = document.getElementById('product-grid');
            const filteredProducts = category === 'All' 
                ? products 
                : products.filter(p => p.category === category);
            
            // Animation reset for re-render
            grid.innerHTML = '';
            
            if (filteredProducts.length === 0) {
                grid.innerHTML = `<div class="col-span-full text-center py-10 text-slate-500">ไม่พบสินค้าในหมวดหมู่นี้</div>`;
                return;
            }

            grid.innerHTML = filteredProducts.map((product, index) => `
                <div class="product-card bg-white rounded-xl shadow-sm border border-slate-100 overflow-hidden fade-in" style="animation-delay: ${index * 0.05}s">
                    <div class="relative h-64 bg-slate-100 group">
                        <img src="${product.image}" alt="${product.name}" class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500">
                        <button onclick="addToCart(${product.id})" class="absolute bottom-4 right-4 bg-white p-3 rounded-full shadow-lg text-indigo-600 hover:bg-indigo-600 hover:text-white transition-all transform translate-y-12 group-hover:translate-y-0 opacity-0 group-hover:opacity-100">
                            <i data-lucide="plus" class="w-5 h-5"></i>
                        </button>
                    </div>
                    <div class="p-6">
                        <span class="text-xs font-semibold text-indigo-500 bg-indigo-50 px-2 py-1 rounded-md">${product.categoryLabel}</span>
                        <h3 class="mt-2 text-lg font-bold text-slate-900 leading-tight">${product.name}</h3>
                        <div class="mt-4 flex justify-between items-center">
                            <span class="text-xl font-bold text-slate-900">฿${product.price.toLocaleString()}</span>
                            <div class="flex items-center text-yellow-400 text-sm">
                                <i data-lucide="star" class="w-4 h-4 fill-current"></i>
                                <span class="ml-1 text-slate-500">4.8</span>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
            lucide.createIcons();
        }

        function filterProducts(category) {
            currentCategory = category;
            
            // Update Active Button
            document.querySelectorAll('.category-btn').forEach(btn => {
                if(btn.innerText === getCategoryLabel(category) || (category === 'All' && btn.innerText === 'ทั้งหมด')) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });

            // Map English category to Thai label for button matching logic helper
            function getCategoryLabel(cat) {
                const map = {
                    'Electronics': 'อิเล็กทรอนิกส์',
                    'Fashion': 'แฟชั่น',
                    'Home': 'ของแต่งบ้าน',
                    'Sports': 'กีฬา'
                };
                return map[cat];
            }

            renderProducts(category);
        }

        function renderCartItems() {
            const container = document.getElementById('cart-items');
            const totalEl = document.getElementById('cart-total');
            const checkoutBtn = document.getElementById('checkout-btn');
            const cartCount = document.getElementById('cart-count');

            // Update Badge
            const totalItems = cart.reduce((acc, item) => acc + item.qty, 0);
            cartCount.innerText = totalItems;
            if (totalItems > 0) {
                cartCount.classList.remove('scale-0');
            } else {
                cartCount.classList.add('scale-0');
            }

            if (cart.length === 0) {
                container.innerHTML = `
                    <li class="py-6 flex flex-col items-center justify-center text-center h-64 text-slate-500">
                        <div class="bg-slate-50 p-4 rounded-full mb-4">
                            <i data-lucide="shopping-basket" class="w-8 h-8 text-slate-400"></i>
                        </div>
                        <p>ตะกร้าของคุณยังว่างอยู่</p>
                    </li>`;
                totalEl.innerText = '฿0';
                checkoutBtn.disabled = true;
                lucide.createIcons();
                return;
            }

            let total = 0;
            container.innerHTML = cart.map(item => {
                total += item.price * item.qty;
                return `
                <li class="flex py-6 fade-in">
                    <div class="h-20 w-20 flex-shrink-0 overflow-hidden rounded-md border border-slate-200">
                        <img src="${item.image}" class="h-full w-full object-cover object-center">
                    </div>
                    <div class="ml-4 flex flex-1 flex-col">
                        <div>
                            <div class="flex justify-between text-base font-medium text-slate-900">
                                <h3>${item.name}</h3>
                                <p class="ml-4">฿${(item.price * item.qty).toLocaleString()}</p>
                            </div>
                            <p class="mt-1 text-sm text-slate-500">${item.categoryLabel}</p>
                        </div>
                        <div class="flex flex-1 items-end justify-between text-sm">
                            <div class="flex items-center border border-slate-300 rounded-md">
                                <button onclick="updateQty(${item.id}, -1)" class="px-2 py-1 text-slate-600 hover:bg-slate-100 rounded-l-md">-</button>
                                <span class="px-2 font-medium text-slate-900">${item.qty}</span>
                                <button onclick="updateQty(${item.id}, 1)" class="px-2 py-1 text-slate-600 hover:bg-slate-100 rounded-r-md">+</button>
                            </div>
                            <button type="button" onclick="removeFromCart(${item.id})" class="font-medium text-red-500 hover:text-red-600 flex items-center gap-1">
                                <i data-lucide="trash-2" class="w-4 h-4"></i> ลบ
                            </button>
                        </div>
                    </div>
                </li>
            `}).join('');

            totalEl.innerText = '฿' + total.toLocaleString();
            checkoutBtn.disabled = false;
            lucide.createIcons();
        }

        // --- Actions ---
        function addToCart(id) {
            const product = products.find(p => p.id === id);
            const existing = cart.find(item => item.id === id);

            if (existing) {
                existing.qty++;
            } else {
                cart.push({ ...product, qty: 1 });
            }

            renderCartItems();
            showToast(`เพิ่ม "${product.name}" ลงตะกร้าแล้ว`, 'success');
        }

        function updateQty(id, change) {
            const item = cart.find(item => item.id === id);
            if (item) {
                item.qty += change;
                if (item.qty <= 0) {
                    removeFromCart(id);
                } else {
                    renderCartItems();
                }
            }
        }

        function removeFromCart(id) {
            cart = cart.filter(item => item.id !== id);
            renderCartItems();
        }

        // --- Authentication ---
        function openLoginModal() {
            document.getElementById('login-modal').classList.remove('hidden');
        }

        function closeLoginModal() {
            document.getElementById('login-modal').classList.add('hidden');
        }

        function handleLogin(e) {
            e.preventDefault();
            // Simulate API Call
            const btn = e.target.querySelector('button');
            const originalText = btn.innerText;
            btn.innerText = 'กำลังเข้าสู่ระบบ...';
            btn.disabled = true;

            setTimeout(() => {
                isLoggedIn = true;
                user = { email: e.target.querySelector('input[type="email"]').value, name: 'Customer' };
                
                // Update UI
                const authSection = document.getElementById('auth-section');
                authSection.innerHTML = `
                    <div class="flex items-center gap-3">
                        <span class="hidden md:inline text-sm font-medium text-slate-700">สวัสดี, คุณลูกค้า</span>
                        <div class="h-8 w-8 bg-indigo-100 rounded-full flex items-center justify-center text-indigo-600 font-bold border border-indigo-200">
                            <i data-lucide="user" class="w-4 h-4"></i>
                        </div>
                    </div>
                `;
                lucide.createIcons();
                
                closeLoginModal();
                showToast('เข้าสู่ระบบสำเร็จ!', 'success');
            }, 1000);
        }

        // --- UI Interactions ---
        function toggleCart() {
            const sidebar = document.getElementById('cart-sidebar');
            const isHidden = sidebar.classList.contains('hidden');
            
            if (isHidden) {
                sidebar.classList.remove('hidden');
                renderCartItems();
            } else {
                sidebar.classList.add('hidden');
            }
        }

        function showToast(message, type = 'success') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.innerHTML = `
                <div class="bg-indigo-100 p-1 rounded-full text-indigo-600">
                    <i data-lucide="check-circle" class="w-5 h-5"></i>
                </div>
                <div class="flex-1">
                    <h4 class="font-medium text-sm text-slate-900">สำเร็จ</h4>
                    <p class="text-sm text-slate-500">${message}</p>
                </div>
            `;
            container.appendChild(toast);
            lucide.createIcons();

            setTimeout(() => {
                toast.style.animation = 'slideInRight 0.3s reverse forwards';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // --- Checkout Flow ---
        function openCheckout() {
            if (!isLoggedIn) {
                showToast('กรุณาเข้าสู่ระบบก่อนชำระเงิน', 'error'); // Visual only, toast styling assumes success but simple enough
                openLoginModal();
                toggleCart();
                return;
            }
            toggleCart();
            
            // Populate Checkout Summary
            const summary = document.getElementById('checkout-items');
            let total = 0;
            summary.innerHTML = cart.map(item => {
                total += item.price * item.qty;
                return `
                <div class="flex justify-between text-sm">
                    <span class="text-slate-600">${item.name} (x${item.qty})</span>
                    <span class="font-medium text-slate-900">฿${(item.price * item.qty).toLocaleString()}</span>
                </div>
            `}).join('');
            document.getElementById('checkout-total').innerText = '฿' + total.toLocaleString();
            
            document.getElementById('checkout-modal').classList.remove('hidden');
        }

        function closeCheckout() {
            document.getElementById('checkout-modal').classList.add('hidden');
        }

        function handlePayment(e) {
            e.preventDefault();
            const btn = e.target.querySelector('button');
            btn.innerHTML = `<i data-lucide="loader-2" class="w-5 h-5 animate-spin"></i> กำลังดำเนินการ...`;
            btn.disabled = true;

            setTimeout(() => {
                closeCheckout();
                document.getElementById('success-overlay').classList.remove('hidden');
                cart = []; // Clear cart
                renderCartItems();
            }, 2000);
        }
    </script>
</body>

</html>
